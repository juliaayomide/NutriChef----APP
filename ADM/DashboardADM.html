<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NutriChef - Dashboard</title>
  <link rel="stylesheet" href="./css/dashboard.css">
  <link rel="stylesheet" href="./css/dashUsuario.css">
  <link rel="stylesheet" href="./css/dashReceitas.css">
  <link rel="stylesheet" href="./css/dashAvaliacoes.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<body>
<div class="app">
  <aside class="sidebar card">
    
    <nav>
      <a class="nav-item active" href="#" data-screen="dashboard">Dashboard</a>
      <a class="nav-item" href="#" data-screen="receitas">Receitas</a>
      <!-- <a class="nav-item" href="#" data-screen="denuncias">Avaliações</a> -->
      <a class="nav-item" href="#"data-screen="graficos">Gráficos</a>
    </nav>
  
  </aside>

  <main class="main">
    <div id="admin-fixed-name">
      <div id="admin-info" style="color:var(--muted);font-size:13px"></div>
      <!-- <div class="avatar"></div> -->
    </div>

    <div class="card topbar">
      <div class="top-left">
        <div class="title" id="page-title">Visão Geral</div>
        <div class="logo"><img src="logo.png" alt="logo"></div>
        <div class="search" style="display: none;">
          <input placeholder="Pesquisar..." id="global-search">
        </div>
      </div>
    </div>

    <div class="screens">
      <!-- DASHBOARD -->
      <section class="card" id="screen-dashboard">
        <div class="grid">
          <div>
            <h3 style="margin:0 0 14px 0;font-weight:700">Sites mais utilizados</h3>
            <div class="list-card" id="sites-list"></div>

            <div style="height:18px"></div>

            <div class="stats">
              <div class="stat">
                <div class="label">Receitas postadas</div>
                <div class="num" id="total-receitas">0</div>
              </div>
              <div class="stat">
                <div class="label">Comentários</div>
                <br>
                <div class="num" id="total-comentarios">0</div>
              </div>
              <div class="stat">
                <div class="label">Usuários cadastrados</div>
                <div class="num" id="total-usuarios">0</div>
              </div>
            </div>
          </div>
      <aside>
       
            <h4>Usuários cadastrados por mês</h4>
            <div class="card" style="padding:15px">
              <canvas id="graficoUsuarios" width="300" height="200"></canvas>
            </div>

        <!-- GRAFICO ESTaTICO -->
            <!-- <h4 style="margin:1px 1px 12px">Ingredientes mais procurados</h4>
               <div class="card" style="padding:10px">
                <div class="donut">
                  
                  <svg viewBox="0 0 42 42" width="220" height="140">
                    <circle cx="21" cy="21" r="15.5" fill="none" stroke="green" stroke-width="8"/>
                    <circle cx="21" cy="21" r="15.5" fill="none" stroke="purple" stroke-width="8" stroke-dasharray="30 70" stroke-linecap="round" transform="rotate(-90 21 21)"/>
                    <circle cx="21" cy="21" r="15.5" fill="none" stroke="orangered" stroke-width="8" stroke-dasharray="18 82" stroke-linecap="round" transform="rotate(-20 21 21)"/>
                    <circle cx="21" cy="21" r="8" fill="#fff"/>
                  </svg>
                </div>
                <div style="display:flex;flex-direction:column;gap:8px;margin-top:6px">
                  <div style="display:flex;justify-content:space-between"><div style="display:flex;gap:8px;align-items:center"><span style="width:10px;height:10px;border-radius:50%;background:green;display:inline-block"></span><span>Batata</span></div><div style="color:var(--muted)">74.6%</div></div>
                  <div style="display:flex;justify-content:space-between"><div style="display:flex;gap:8px;align-items:center"><span style="width:10px;height:10px;border-radius:50%;background:purple;display:inline-block"></span><span>Cebola</span></div><div style="color:var(--muted)">5.0%</div></div>
                  <div style="display:flex;justify-content:space-between"><div style="display:flex;gap:8px;align-items:center"><span style="width:10px;height:10px;border-radius:50%;background:orangered;display:inline-block"></span><span>Frango</span></div><div style="color:var(--muted)">3.3%</div></div>
                </div>
              </div> -->
          </aside>

          
            <!-- Card de Usuários -->
            <div class="card users-card">
              <div class="users-card-header">
                <h4>Usuários</h4>
                <div class="meta-muted" id="users-count-inline">0</div>
              </div>

              <input id="user-search" class="user-search" style="border: solid 1px #000;" placeholder="Pesquisar usuários por nome..." />

              <div id="users-container">
                <div id="users-list" class="users-list"></div>
                <div id="no-users-msg" class="no-users" style="display:none">Nenhum usuário cadastrado no momento.</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- RECEITAS -->
      <section class="card" id="screen-receitas" style="display:none">
        <h3>Receitas Cadastradas</h3>

        <div class="receitas-top">
          <input type="text" id="search-receita" style="border: solid 3px #000;" placeholder="Pesquisar receita..." />
        </div>

        <ul id="receitas-lista" class="receitas-lista"></ul>
      </section>

      <!-- Modal de confirmação -->
      <div id="delete-modal" class="modal" style="display:none;">
        <div class="modal-content">
          <h3>Excluir Receita</h3>
          <p>Tem certeza que deseja excluir esta receita?</p>
          <div class="modal-buttons">
            <button id="confirm-delete">Sim, excluir</button>
            <button id="cancel-delete">Cancelar</button>
          </div>
        </div>
      </div>


      <!-- AVALIAÇÕES -->
      <section class="card" id="screen-denuncias" style="display:none">
        <h3>Avaliações</h3>

        <div class="denuncias-top">
          <input type="text" id="search-denuncia" style="border: solid 1px #000; width: 350px; height: 35px; border-radius: 7px;" placeholder="Pesquisar avaliações..." />
        </div>

        <div id="denuncias-container" class="denuncias-container"></div>
      </section>

      <!-- Gráficos  -->
      <section class="card" id="screen-graficos" style="display:none">

        <h3>Gráficos Gerais</h3>

        <div class="card" style="padding:20px; margin-bottom:20px;">
            <h4>Ingredientes mais usados (%)</h4>
            <canvas id="graficoIngredientes" width="400" height="250"></canvas>
        </div>

        <div id="lista-legenda-ingredientes" class="legenda-lista"></div>

    </section>

      <!-- Modal de Receitas -->
      <div id="modal-receita" class="modal" style="display:none;">
        <div class="modal-content"> 
          <div id="conteudo-receita"></div>
        </div>
      </div>
    </div>
  </main>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>

async function carregarUsuarios() {
  try {
    const res = await fetch("http://localhost:3000/api/usuariosPorMes");
    const dados = await res.json();

    const labels = dados.map(x => x.mes);
    const valores = dados.map(x => x.total);

    const ctx = document.getElementById("graficoUsuarios").getContext("2d");

    // Gradiente suave azul
    const gradient = ctx.createLinearGradient(0, 0, 0, 300);
    gradient.addColorStop(0, "rgba(0, 122, 255, 0.35)");
    gradient.addColorStop(1, "rgba(0, 122, 255, 0)");

    new Chart(ctx, {
      type: "line",
      data: {
        labels,
        datasets: [{
          label: "Usuários cadastrados",
          data: valores,
          borderColor: "rgb(255, 119, 0)",
          backgroundColor: gradient,
          borderWidth: 3,
          fill: true,
          tension: 0.4,
          pointRadius: 4,
          pointBackgroundColor: "rgb(250, 137, 50)",
          pointBorderWidth: 2,
          pointHoverRadius: 7,
          pointHoverBackgroundColor: "white",
          pointHoverBorderColor: "rgb(250, 137, 50)",
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: true,
            labels: {
              font: { size: 13, weight: "600" },
              color: "#444"
            }
          },
          tooltip: {
            backgroundColor: "rgba(30, 30, 30, 0.85)",
            padding: 10,
            titleFont: { size: 14, weight: "bold" },
            bodyFont: { size: 13 },
            cornerRadius: 8
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            ticks: {
              font: { size: 12 },
              color: "#666"
            },
            grid: {
              color: "rgba(0,0,0,0.08)"
            }
          },
          x: {
            ticks: {
              font: { size: 12 },
              color: "#666"
            },
            grid: { display: false }
          }
        }
      }
    });

  } catch (err) {
    console.error("Erro ao carregar gráfico:", err);
  }
}

carregarUsuarios();
</script>



  <script src="./js/dashUsuario.js"></script>
  <script src="./js/dashReceitas.js"></script>
</body>
</html>
